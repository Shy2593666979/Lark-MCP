## 一、背景与问题概述

当前需求为在多租户场景下使用飞书MCP服务，但现有部署方案存在显著资源消耗问题：
- 飞书MCP服务启动时需绑定单个租户的专属参数
- 每支持1个租户需独立部署1个服务实例，即1000个租户需1000台服务器
- 服务器资源占用率高、运维成本激增、扩展性极差

基于以上痛点，需探索更优的多租户部署方案。

## 二、现有方案分析

### 方案一：原生部署（仿魔搭）


#### 1. 部署架构
```
每个租户独立部署飞书MCP服务，各自占用服务器资源，架构如下：
租户A → 服务器A（飞书MCP实例A）
租户B → 服务器B（飞书MCP实例B）
...
租户N → 服务器N（飞书MCP实例N）
```

#### 2. 优缺点分析
- 优点
  - 租户间完全隔离，数据安全性高
  - 单个租户服务故障不影响其他租户
  - 部署简单，直接使用原生服务
- 缺点
  - 资源消耗与租户数量成正比，扩展成本极高
  - 运维复杂度高（需管理N个实例）
  - 版本迭代需同步更新所有实例，效率低

### 方案二：封装统一服务

#### 1. 核心思路
基于飞书Lark-openapi重新封装MCP服务，打造统一的多租户MCP Server：
- 服务端通过数据库存储所有租户的飞书配置信息（如AppID、AppSecret等）
- 接收请求时，根据租户ID从数据库查询对应配置，动态调用飞书API
- 仅需部署1个服务实例，支持所有租户共享使用

#### 2. 部署架构
```
多租户请求 → 统一MCP Server → 数据库（租户配置）
                               ↓
                         飞书Lark-openapi
```

#### 3. 与同类服务的一致性
该方案与现有高德地图、Minimax的MCP Server架构保持一致：
- 统一服务入口
- 配置集中管理，支持动态更新
- 单实例部署，降低资源占用和运维成本

## 三、目前支持的工具函数详细描述列表

1. **append_calendar_event_attendee**
   - **功能描述**：为日历事件添加参会者，通过指定日历ID、事件ID等信息，将用户添加到相应的日历事件中，可选择是否发送通知给参会者，适用于需要补充会议参与人员的场景。
   - **所需参数**：
     - calendar_id：日历ID，必填参数。用于确定要操作的日历。
     - event_id：日程事件ID，必填参数。指定需要添加参会者的具体日程事件。
     - user_id_type：用户ID类型，必填参数。可选值为“open_id”“user_id”“union_id”，用于标识参会者ID的类型。
     - attendees：参会者列表，必填参数。每个元素需包含对应的用户ID，用于指定要添加的参会者。
     - app_id：应用唯一标识，必填参数。应用的专属标识，用于接口调用的身份识别。
     - app_secret：应用密钥，必填参数。与app_id配合使用，保障接口调用的安全性。
     - need_notification：是否需要发送通知，必填参数。用于设置是否向添加的参会者发送通知。

2. **book_meeting**
   - **功能描述**：预约会议（创建会议预约），可设置会议的时间、主题、组织者、主持人等信息，支持自动录制会议等功能，方便快速安排会议。
   - **所需参数**：
     - end_time：会议结束时间，必填参数。以Unix时间戳（秒）的形式表示，用于确定会议的结束时刻。
     - owner_id：会议组织者ID，必填参数。通常为用户的open_id，标识会议的组织者。
     - topic：会议主题，必填参数。简要说明会议的主要内容，方便参会者了解会议目的。
     - meeting_initial_type：会议初始类型，必填参数。默认值为1，代表多人会议。
     - meeting_connect：是否支持互通，必填参数。默认值为True，且不支持更新，用于设置会议是否支持互通功能。
     - auto_record：是否自动录制会议，必填参数。默认值为True，用于设置会议是否自动进行录制。
     - assign_host_list：会议主持人列表，必填参数。每个元素需包含用户的id，用于指定会议的主持人。
     - password：会议密码，可选参数。可设置密码对会议进行保护，增强会议的安全性。
     - app_id：应用唯一标识，可选参数。在特定应用环境下预约会议时使用。
     - app_secret：应用密钥，可选参数。用于验证应用的身份，保障接口调用的安全性。

3. **create_calendar_event**
   - **功能描述**：创建飞书日历日程，可设置日程的标题、描述、时间、地点、参会者等多种信息，满足不同场景下的日程安排需求，创建成功后可返回日程信息及参会人添加情况。
   - **所需参数**：
     - user_id_type：用户ID类型，可选参数。默认值为“open_id”，可选值还有“union_id”“user_id”，用于指定用户ID的类型。
     - summary：日程标题，必填参数。概括日程的主要内容，便于识别日程。
     - description：日程描述，必填参数。详细说明日程的相关信息，让参会者更清楚日程详情。
     - need_notification：是否发送通知，可选参数。默认值为True，用于设置更新日程时是否给参与人发送通知。
     - start_date：开始日期，必填参数。格式为YYYY-MM-DD，指定日程开始的日期。
     - start_timestamp：开始时间戳，必填参数。例如1602504000，用于精确表示日程开始的时间。
     - end_date：结束日期，必填参数。格式为YYYY-MM-DD，指定日程结束的日期。
     - end_timestamp：结束时间戳，必填参数。例如1602504000，用于精确表示日程结束的时间。
     - location_name：日程的会议位置，可选参数。用于说明日程举办的地点名称。
     - location_address：日程的会议具体地点，可选参数。如301会议室，更详细地说明日程举办位置。
     - attendees：参会者列表，可选参数。每个元素需包含用户的open_id，用于指定日程的参会者。
     - timezone：时区，可选参数。默认值为“Asia/Shanghai”，用于设置日程所使用的时区。
     - visibility：日程公开范围，可选参数。默认值为“default”，用于设置日程的公开程度。
     - attendee_ability：参与者权限，可选参数。默认值为“can_see_others”，用于规定参与者所拥有的权限。
     - free_busy_status：忙闲状态，可选参数。默认值为“busy”，表示日程占用的忙闲状态。
     - recurrence：重复规则，可选参数。如“FREQ=DAILY;INTERVAL=1”，用于设置日程是否重复及重复的规则。
     - app_id：应用唯一标识，可选参数。在特定应用环境下创建日程时使用。
     - app_secret：应用密钥，可选参数。用于验证应用的身份，保障接口调用的安全性。

4. **delete_calendar_event**
   - **功能描述**：删除日程事件，通过指定日历ID和事件ID，可删除对应的日程事件，还可选择是否通知参与者，用于取消不再需要的日程。
   - **所需参数**：
     - calendar_id：日历ID，必填参数。用于确定要删除的日程事件所在的日历。
     - event_id：日程事件ID，必填参数。指定需要删除的具体日程事件。
     - need_notification：是否通知参与者，可选参数。默认值为“true”，可选值为“true”“false”，用于设置删除日程时是否通知参与者。
     - app_id：应用唯一标识，可选参数。在特定应用环境下删除日程时使用。
     - app_secret：应用密钥，可选参数。用于验证应用的身份，保障接口调用的安全性。

5. **get_calendar_event**
   - **功能描述**：获取日历事件详情，可获取日程事件的基本信息、会议设置信息、参会者信息等，方便了解日程的具体情况。
   - **所需参数**：
     - calendar_id：日历ID，必填参数。用于确定要获取详情的日程事件所在的日历。
     - event_id：日程事件ID，必填参数。指定需要获取详情的具体日程事件。
     - need_meeting_settings：是否需要返回会议设置信息，可选参数。默认值为True，用于设置是否获取会议相关的设置信息。
     - need_attendee：是否需要返回参会者信息，可选参数。默认值为True，用于设置是否获取参会者的相关信息。
     - max_attendee_num：最大返回参会者数量，可选参数。默认值为10，用于限制返回的参会者数量。
     - user_id_type：用户ID类型，可选参数。默认值为“open_id”，可选值还有“user_id”“union_id”，用于指定用户ID的类型。
     - app_id：应用唯一标识，可选参数。在特定应用环境下获取日程详情时使用。
     - app_secret：应用密钥，可选参数。用于验证应用的身份，保障接口调用的安全性。

6. **update_calendar_event**
   - **功能描述**：更新飞书的日程，可修改日程的标题、描述、时间、地点等多种信息，适用于日程信息需要调整的场景，更新成功后返回更新后的日程信息。
   - **所需参数**：
     - calendar_id：日历ID，必填参数。用于确定要更新的日程事件所在的日历。
     - event_id：日程事件ID，必填参数。指定需要更新的具体日程事件。
     - user_id_type：用户ID类型，可选参数。默认值为“open_id”，可选值还有“union_id”“user_id”，用于指定用户ID的类型。
     - summary：日程标题，可选参数。需要更新的日程标题，用于修改日程的名称。
     - description：日程描述，可选参数。需要更新的日程描述，用于完善或修改日程的详细信息。
     - start_date：开始日期，可选参数。需要更新的开始日期，格式为YYYY-MM-DD。
     - start_timestamp：开始时间戳，可选参数。需要更新的开始时间戳，如1602504000。
     - end_date：结束日期，可选参数。需要更新的结束日期，格式为YYYY-MM-DD。
     - end_timestamp：结束时间戳，可选参数。需要更新的结束时间戳，如1602504000。
     - location_name：日程的会议位置，可选参数。需要更新的日程的地点名称，如301会议室。
     - location_address：日程的会议具体地点，可选参数。需要更新的日程的会议具体地址，如公司大楼一楼。
     - timezone：时区，可选参数。默认值为“Asia/Shanghai”，用于设置日程所使用的时区。
     - visibility：日程公开范围，可选参数。需要更新的日程公开范围。
     - attendee_ability：参与者权限，可选参数。需要更新的参与者权限。
     - free_busy_status：忙闲状态，可选参数。需要更新的日程占用的忙闲状态，新建日程默认为busy。
     - recurrence：重复规则，可选参数。需要更新的重复规则，如FREQ=DAILY;INTERVAL=1。
     - app_id：应用唯一标识，可选参数。在特定应用环境下更新日程时使用。
     - app_secret：应用密钥，可选参数。用于验证应用的身份，保障接口调用的安全性。

7. **create_chat_member**
   - **功能描述**：创建群聊，可设置群聊名称、描述、群主、群成员、机器人等信息，以及群聊的各项权限设置，方便建立多人交流群组。
   - **所需参数**：
     - user_id_type：用户ID类型，可选参数。默认值为“open_id”，可选值还有“union_id”“user_id”，用于指定用户ID的类型。
     - chat_name：群聊名称，必填参数。不能为空，用于标识群聊的名称。
     - chat_description：群聊的简要描述，必填参数。用于说明群聊的用途或相关信息。
     - owner_id：群主的用户ID，必填参数。为open_id格式，标识群聊的创建者和管理者。
     - user_id_list：创建群聊时拉入的用户ID列表，必填参数。为open_id格式，用于指定群聊的初始成员。
     - bot_id_list：群聊中添加的机器人ID列表，必填参数。如果没有可设置为[]，用于指定群聊中的机器人。
     - chat_avatar：群聊的图标链接，可选参数。默认值为“default-avatar_44ae0ca3-e140-494b-956f-78091e348435”，用于设置群聊的头像。
     - app_id：应用唯一标识，可选参数。在特定应用环境下创建群聊时使用。
     - app_secret：应用密钥，可选参数。用于验证应用的身份，保障接口调用的安全性。

8. **delete_chat_member**
   - **功能描述**：删除群聊，通过指定群聊ID，可将对应的群聊删除，适用于不再需要的群聊的清理。
   - **所需参数**：
     - chat_id：群聊ID，必填参数。用于指定需要删除的群聊。
     - app_id：应用唯一标识，可选参数。在特定应用环境下删除群聊时使用。
     - app_secret：应用密钥，可选参数。用于验证应用的身份，保障接口调用的安全性。

9. **get_chat_member_info**
   - **功能描述**：获取群聊的群信息，通过群聊ID可获取群聊的详细信息，包括群名称、描述、成员等内容，方便了解群聊的基本情况。
   - **所需参数**：
     - user_id_type：用户ID类型，可选参数。默认值为“open_id”，可选值还有“union_id”“user_id”，用于指定用户ID的类型。
     - chat_id：群聊的ID，必填参数。用于指定需要获取信息的群聊。
     - app_id：应用唯一标识，可选参数。在特定应用环境下获取群聊信息时使用。
     - app_secret：应用密钥，可选参数。用于验证应用的身份，保障接口调用的安全性。

10. **get_document**
    - **功能描述**：获取文档内容，通过文档ID可获取对应的文档内容，方便查看文档的具体信息。
    - **所需参数**：
      - document_id：文档ID，必填参数。用于指定需要获取内容的文档。
      - app_id：应用唯一标识，可选参数。在特定应用环境下获取文档内容时使用。
      - app_secret：应用密钥，可选参数。用于验证应用的身份，保障接口调用的安全性。

11. **create_folder**
    - **功能描述**：创建文件夹并获取文件夹的Token，可指定文件夹名称和父文件夹，用于在云空间中组织和管理文件。
    - **所需参数**：
      - name：文件夹名称，必填参数。用于标识文件夹的名称。
      - folder_token：父文件夹token，可选参数。默认值为空，用于指定新创建文件夹的父文件夹，为空时创建在根目录。
      - app_id：应用唯一标识，可选参数。在特定应用环境下创建文件夹时使用。
      - app_secret：应用密钥，可选参数。用于验证应用的身份，保障接口调用的安全性。

12. **list_folder_files**
    - **功能描述**：获取文件夹下的文件列表，可设置分页大小、排序方式等，方便查看文件夹内的文件情况。
    - **所需参数**：
      - folder_token：文件夹token，可选参数。不填或为空时获取用户云空间根目录清单（不支持分页），用于指定要获取文件列表的文件夹。
      - page_size：每页显示的数据项数量，可选参数。默认值为20，取值范围1到200，若获取根目录清单，将返回全部数据。
      - order_by：文件排序字段，可选参数。默认值为“EditedTime”，只允许“EditedTime”“CreatedTime”，用于指定文件的排序依据。
      - direction：排序方向，可选参数。默认值为“DESC”，允许“ASC”“DESC”，用于设置排序的升序或降序。
      - user_id_type：用户ID类型，可选参数。默认值为“open_id”，允许“open_id”“union_id”“user_id”，用于指定用户ID的类型。
      - app_id：应用唯一标识，可选参数。在特定应用环境下获取文件夹文件列表时使用。
      - app_secret：应用密钥，可选参数。用于验证应用的身份，保障接口调用的安全性。

13. **create_message**
    - **功能描述**：发送消息，可向用户或群组发送不同类型的消息，如文本、图片等，满足不同的沟通需求。
    - **所需参数**：
      - receive_id：消息接收者的ID，必填参数。ID类型与receive_id_type一致，给用户发消息需确保用户在机器人可用范围内，给群组发消息需确保机器人在群内且有发言权限。
      - msg_type：消息类型，必填参数。可选值包括“text”“post”“image”“file”“audio”“media”“sticker”“interactive”“share_chat”“share_user”“system”等，用于指定消息的类型。
      - content：消息内容JSON字符串，必填参数。需根据msg_type设置对应格式，不需要转义，例如{'text': '你好啊，你是谁？'}。
      - receive_id_type：接收者ID类型，可选参数。默认值为“open_id”，可选值为“open_id”“user_id”“union_id”“email”“chat_id”，用于指定接收者ID的类型。
      - app_id：应用唯一标识，可选参数。在特定应用环境下发送消息时使用。
      - app_secret：应用密钥，可选参数。用于验证应用的身份，保障接口调用的安全性。

14. **get_id_user_request**
    - **功能描述**：能够根据用户的邮箱或者手机号查找用户的信息，方便通过邮箱或手机号获取用户的相关信息。
    - **所需参数**：
      - user_id_type：用户ID类型，可选参数。默认值为“open_id”，用于指定返回的用户ID类型。
      - emails：邮箱列表，可选参数。最多50个邮箱，不支持企业邮箱，与mobiles独立查询，用于根据邮箱查找用户。
      - mobiles：手机号列表，可选参数。最多50个手机号，海外需带国家代码+xxx，与emails独立查询，用于根据手机号查找用户。
      - include_resigned：是否包含已离职员工，可选参数。默认值为True，用于设置查询结果是否包含已离职员工。
      - app_id：应用唯一标识，可选参数。在特定应用环境下查找用户信息时使用。
      - app_secret：应用密钥，可选参数。用于验证应用的身份，保障接口调用的安全性。

15. **batch_get_user_info**
    - **功能描述**：根据该工具可以批量获取用户的具体信息，通过用户ID列表可一次性获取多个用户的详细信息，提高信息获取效率。
    - **所需参数**：
      - user_ids：用户ID列表，必填参数。ID类型与user_id_type参数一致，单次请求最多支持50个用户ID，用于指定需要获取信息的用户。
      - user_id_type：用户ID类型，可选参数。默认值为“open_id”，可选值为“open_id”“union_id”“user_id”，用于指定用户ID的类型。
      - department_id_type：部门ID类型，可选参数。默认值为“open_department_id”，可选值为“open_department_id”“department_id”，用于指定